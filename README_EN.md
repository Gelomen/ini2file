# ini2file

[中文](./README.md) | English

## Introduction

Read `.ini` config and `.tmpl` templates to batch generate files, with each `session` in the `.ini` corresponding to one file (except `i2f_common_session`).

## Usage

Add `ini2file` to `plugins` in `rebar.config`

```erlang

{plugins, [
    {ini2file, {git, "https://github.com/Gelomen/ini2file.git", {branch, "master"}}}
]}.

```

### Direct exec

```bash
rebar3 ini2file gen
```

### Auto Generate with Hooks

Add config to `provider_hooks` in `rebar.config`

```erlang

{provider_hooks, [
    {pre, [
        {compile, {ini2file, gen}}
    ]}
]}.

```

then exec

```bash
rebar3 compile
```

## Configure

Read the fields of the `.ini` config and replace the contents of the template, such as:

> The value `127.0.0.1` of `domain` replaces `{{domain}}` in the template file.

### .ini

Path: `ini/my_config.ini`

```ini
[i2f_common_session]
domain = 127.0.0.1

[foo]
port = 8080

[bar]
port = 9090

```

> A `session` can be configured with the same parameters as `[i2f_common_session]` to override the common config without affecting other `sessions`.

Example::

```ini
[i2f_common_session]
domain = 127.0.0.1

[foo]
domain = localhost
port = 8080

[bar]
port = 9090

```

### .tmpl

Path: `templates/erl.tmpl`

```tmpl
%% Generated by plugin `ini2file`, don't edit.

-module({{i2f_file_name}}).

-export([
    host/0
]).

host() ->
    "{{domain}}:{{port}}".

```

## rebar.config

```erlang

{plugins, [
    {ini2file, {git, "https://github.com/Gelomen/ini2file.git", {branch, "master"}}}
]}.

{ini2file, [
    % ini 配置
    {ini, [
        % {ini_name, ini_path, [tmpl_name]}
        {my, "ini/my_config.ini", [erl]}                            % {config name, config path, [template name]}
    ]},
    % templates config
    {templates, [
        {erl, [
            % File name, the following config will result in: `src/my_foo_xxx.erl` and `src/my_bar_xxx.erl`
            {file, [
                {name, [i2f_ini_name, i2f_session_name, "xxx"]},    % Words to concat for the file name, atom | int | string | bit_string
                {suffix, ".erl"},                                   % File suffix
                {save_path, "src"}                                  % File save path
            ]},
            {tmpl_path, "templates/erl.tmpl"}                       % Template path
        ]}
    ]}
]}.

```

## Built-in Parameters

| Parameter                | Description                                       | Example              |
|:-------------------------|:--------------------------------------------------|:---------------------|
| `{{i2f_ini_name}}`       | The name of `ini` config                          | `my`                 |
| `{{i2f_session_name}}`   | The name of `session` in `.ini` file              | `foo`                |
| `{{i2f_file_name}}`      | The name of the generated file (without suffix)   | `my_foo_xxx`         |
| `{{i2f_file_full_name}}` | The full name of the generated file (with suffix) | `my_foo_xxx.erl`     |
| `{{i2f_file_path}}`      | The path of the generated file                    | `src/my_foo_xxx.erl` |
